#!/bin/bash

DEFAULT=/etc/default/snf-network

source $DEFAULT
source $CONF

case $SETUP in
GRNET)
  INFRA=/etc/snf-network/grnet.conf
  ;;
GENERIC)
  INFRA=/etc/snf-network/generic.conf
  ;;
esac

source $INFRA

HOSTINFRA=$STATE_DIR/infra

NODE_IFACE=$(ip route | grep default | awk '{print $5}')
NODE_MAC=$(ip link show $NODE_IFACE | grep link/ether | awk '{print $2}')
NODE_IPS="$(ip a show $NODE_IFACE | grep "inet " | awk '{print $2}')"
NODE_GW=$(ip route | grep default | awk '{print $3}')

(

cat $INFRA

echo
echo "# node's interface" 
echo NODE_IFACE=$NODE_IFACE 

echo 
echo "# node's MAC" 
echo NODE_MAC=$NODE_MAC

echo 
echo "# node's IPs" 
echo NODE_IPS=\"$NODE_IPS\"

echo 
echo "# node's Gateway" 
echo NODE_GW=$NODE_GW

case $SETUP in
GRNET) 
  if [ -n "$PUBLIC_VLAN_ID" ]; then
    echo 
    echo PUBLIC_VLAN=$NODE_IFACE.$PUBLIC_VLAN_ID
    echo PUBLIC_LINK=$ROUTING_TABLE
  fi

  if [ -n "$PRIVATE_VLAN_ID" ]; then
    echo 
    echo PRIVATE_VLAN=$NODE_IFACE.$PRIVATE_VLAN_ID
    echo PRIVATE_BRIDGE=$BRIDGE_PREFIX$PRIVATE_BRIDGE_ID
  fi
  ;;
GENERIC)
  echo
  echo PUBLIC_LINK=$PUBLIC_BRIDGE
  ;;
esac

)  > $HOSTINFRA
